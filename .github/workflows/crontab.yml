on:
  push:
    branches:
      - main
  schedule:
    - cron: '0 10 * * *'

jobs:
    contab-build:
      runs-on: ubuntu-latest
      strategy:
        matrix:
          python: [3.9, 3.10, 3.11, 3.12]
      steps:
        - name: Checkout
          uses: actions/checkout@v4
          with:
            fetch-depth: 1
            path: crontab
        - uses: actions/checkout@v4
          with:
            repository: wojiushixiaobai/Loongson-dockerfiles
            ref: upstream/main
            fetch-depth: 1
            path: dockerfiles

        - name: Check Python ${{ matrix.python }} latest version
          run: |
            check_version=${{ matrix.python }}
            cd dockerfiles
            git config --global user.name "${GITHUB_ACTOR}"
            git config --global user.email "${GITHUB_ACTOR}@users.noreply.github.com"
            git checkout -b renovate_python_version_${check_version}
            bash ../crontab/check_python.sh ${check_version}
            if ! git diff --quiet; then
                git commit -am "build(python): bump library/python ${check_version} to latest"
                git push origin renovate_python_version_${check_version} || true
                # gh pr create --title "build(python): bump library/python ${check_version} to latest" --base upstream/main --head renovate_python_version_${check_version}
            fi
          env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}



